pg-operator:
  enabled: true
pg-db:
  enabled: true
  # users:
  #   - name: rhino
  #     databases:
  #       - zoo
  #     options: "NOSUPERUSER"
  #     password:
  #       type: ASCII
  #     secretName: "rhino-credentials"
  instances:
  - name: instance1
    replicas: 2
    dataVolumeClaimSpec:
      # storageClassName: default
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 1Gi
    sidecars:
    - name: postgres-exporter
      image: quay.io/prometheuscommunity/postgres-exporter
      env:
      # - name: DATA_SOURCE_URI
      #   valueFrom:
      #     secretKeyRef:
      #       name: pg-db-pguser-pg-db
      #       key: pgbouncer-uri
      # - name: DATA_SOURCE_USER
      #   valueFrom:
      #     secretKeyRef:
      #       name: pg-db-pguser-pg-db
      #       key: user
      - name: DATA_SOURCE_PASS
        valueFrom:
          secretKeyRef:
            name: pg-db-pguser-pg-db
            key: password
      - name: DATA_SOURCE_NAME
        value: "postgresql://pg-db:$(DATA_SOURCE_PASS)@pg-db-pgbouncer.pgns.svc:5432/pg-db"
      - name: CONFIG_FILE
        value: "" # Ensure this is empty to avoid the config file requirement
        # value: "postgresql://$(DATA_SOURCE_USER):$(DATA_SOURCE_PASS)@$(DATA_SOURCE_URI)/pg-db?sslmode=disable"
    # - name: testcontainer2
    #   image: mycontainer1:latest
  pmm:
    enabled: false
    image:
      repository: percona/pmm-client
      tag: 2.42.0
  #  imagePullPolicy: IfNotPresent
    secret: cluster1-pmm-secret
    serverHost: monitoring-service
  #  resources:
  #    requests:
  #      memory: 200M
  #      cpu: 500m
  proxy:
    pgBouncer:
      replicas: 2
      config:
        global:
          client_tls_sslmode: prefer
  patroni:
    # Some values of the Liveness/Readiness probes of the patroni container are calulated using syncPeriodSeconds by the following formulas:
    # - timeoutSeconds:   syncPeriodSeconds / 2;
    # - periodSeconds:    syncPeriodSeconds;
    # - failureThreshold: leaderLeaseDurationSeconds / syncPeriodSeconds.
    syncPeriodSeconds: 10
    leaderLeaseDurationSeconds: 30
    dynamicConfiguration:
      postgresql:
        parameters:
          max_parallel_workers: 2
          max_worker_processes: 2
          shared_buffers: 1GB
          work_mem: 2MB
        pg_hba:
        - host    all mytest 123.123.123.123/32 reject
    switchover:
      enabled: "true"
      targetInstance: ""
